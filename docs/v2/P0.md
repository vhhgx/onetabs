# P0 - 核心功能（MVP必须）

> **优先级**：P0 - 最高优先级  
> **目标**：实现产品MVP的基础功能  
> **预计时间**：2-3周  
> **状态图例**：✅ 已完成 | 🚧 进行中 | ⏳ 待开始

---

## 1. Background Service Worker（后台服务）

### 1.1 扩展图标点击处理
- [x] 监听扩展图标点击事件 `chrome.action.onClicked`
- [x] 获取当前窗口信息 `chrome.windows.getCurrent()`
- [x] 触发标签页保存流程

### 1.2 标签页数据获取
- [x] 使用 `chrome.tabs.query()` 获取当前窗口所有标签页
- [x] 使用 `chrome.tabGroups.query()` 获取标签页组信息
- [x] 获取每个标签页的详细信息：
  - [x] 标题（title）
  - [x] URL（url）
  - [x] 图标（favIconUrl）
  - [x] 是否固定（pinned）
  - [x] 所属分组ID（groupId）
  - [x] 索引位置（index）

### 1.3 数据组织与存储
- [x] 将标签页按分组组织成结构化数据
- [x] 区分已分组和未分组的标签页
- [x] 生成唯一会话ID和时间戳
- [x] 保存数据到 `chrome.storage.local`
- [x] 存储键名：`tabGroups`

### 1.4 标签页关闭逻辑
- [x] 获取所有需要关闭的标签页ID
- [x] 过滤掉扩展自身页面
- [x] 可选：根据设置过滤固定标签页
- [x] 批量关闭标签页 `chrome.tabs.remove()`
- [x] 确保至少保留一个标签页（扩展页面）

### 1.5 扩展页面打开
- [x] 关闭完成后自动打开扩展页面
- [x] 使用 `chrome.tabs.create()` 创建新标签页
- [x] 跳转到扩展主页 `index.html`

---

## 2. 基础UI框架搭建

### 2.1 页面布局结构
- [x] 创建顶部导航栏组件 `AppHeader.vue`
  - [x] Logo和产品名称显示
  - [x] 设置按钮
- [x] 创建Tab导航组件 `TabNavigation.vue`（在主页面内部）
  - [x] 三个Tab：会话收纳、收藏集、模板
  - [x] Tab切换逻辑（使用局部状态，不使用路由）
  - [x] 高亮当前活动Tab
  - [x] 根据Tab显示对应内容区域

注：三个功能模块在同一个页面中，通过Tab切换显示不同内容，不使用Vue Router的路由切换

### 2.2 路由配置
- [x] 配置 Vue Router
- [x] 主路由配置：
  - [x] `/` - 主页面（包含三个Tab：会话收纳、收藏集、模板）
  - [x] 设置页面集成在Tab中
- [x] 默认显示会话收纳Tab

注：不使用三个独立路由页面，改用单页面内Tab切换方式，通过组件内部状态管理当前显示的Tab

#### 实现逻辑（伪代码）

```
主页面结构:
├─ 顶部导航栏 (AppHeader)
└─ Tab容器
   ├─ Tab导航栏
   │  ├─ Tab按钮: 会话收纳 (默认选中)
   │  ├─ Tab按钮: 标签页组
   │  └─ Tab按钮: 窗口模板
   └─ Tab内容区
      └─ 根据 activeTab 显示对应视图组件

状态管理:
  activeTab = 'sessions'  // 默认显示会话收纳
  
Tab切换逻辑:
  当用户点击Tab按钮:
    设置 activeTab = 点击的Tab值
    根据 activeTab 切换显示对应的视图组件
    
视图组件映射:
  'sessions' → SessionsView（会话收纳视图）
  'collections' → CollectionsView（标签页组视图）
  'templates' → TemplatesView（窗口模板视图）

路由配置:
  主路由: / → MainView（包含上述Tab结构）
  可选路由: /settings → Settings（独立设置页面）
```

---

## 3. 会话收纳功能（Sessions）

### 3.1 Pinia Store - sessionsStore
- [x] 创建 `stores/sessionsStore.js`
- [x] State定义：
  - [x] `sessions: []` - 所有会话列表
  - [x] `isLoading: false` - 加载状态
- [x] Actions实现：
  - [x] `loadSessions()` - 从Storage加载会话
  - [x] `saveSession(data)` - 保存新会话
  - [x] `deleteSession(id)` - 删除会话
  - [x] `restoreSession(id)` - 恢复整个会话
  - [x] `restoreGroup(sessionId, groupId)` - 恢复单个组
  - [x] `restoreTab(tab)` - 恢复单个标签页
  - [x] `togglePinSession(id)` - 切换会话置顶
  - [x] `clearAllSessions()` - 清除所有会话

注：目前使用tabsStore和groupsStore，功能分散在TabGroups.vue中，需要重构为sessionsStore

### 3.2 会话列表展示
- [x] 创建 `SessionCard.vue` 组件
  - [x] 显示保存时间（相对时间格式）
  - [x] 显示标签页总数
  - [x] 显示操作按钮：恢复、删除、置顶
  - [x] 支持折叠/展开
  - [x] 置顶会话显示特殊样式
- [x] 集成标签页组显示（会话内的标签页组）
  - [x] 显示组名称和颜色指示器
  - [x] 显示组内标签页数量
  - [x] 标签页列表展示
  - [x] 操作按钮：恢复组、删除组
- [x] 创建 `TabItem.vue` 组件
  - [x] 显示网站图标（favicon）
  - [x] 显示页面标题
  - [x] 点击打开链接
  - [x] 悬停显示完整URL（通过title属性）

注：功能已在TabGroups.vue中实现，但未独立为组件

### 3.3 会话数据结构
```javascript
{
  id: string,              // 唯一ID
  timestamp: number,       // 保存时间戳
  windowId: number,        // 窗口ID
  groups: [                // 标签页组列表
    {
      groupId: number,
      title: string,
      color: string,
      collapsed: boolean,
      tabs: [...]
    }
  ],
  ungroupedTabs: []        // 未分组的标签页
}
```

### 3.4 会话恢复功能
- [x] 恢复整个会话：
  - [x] 在当前窗口打开所有标签页
  - [x] 按原结构恢复所有标签页
  - [x] 恢复标签页组（Chrome Tab Groups）
  - [x] 设置组颜色和名称
- [x] 恢复单个标签页组：
  - [x] 批量创建组内所有标签页
  - [x] 创建Chrome Tab Group
  - [x] 应用组配置
- [x] 恢复单个标签页：
  - [x] 在新标签页打开URL
  - [x] 保持原有数据不变

### 3.5 会话删除功能
- [x] 删除确认对话框（使用PrimeVue ConfirmDialog）
- [x] 从sessions数组中移除
- [x] 更新Storage
- [x] 显示删除成功提示（使用Toast）

---

## 4. 基础设置功能

### 4.1 设置页面 `Settings.vue`
- [x] 创建设置页面组件
- [x] 快速收纳设置：
  - [x] 点击图标后自动关闭标签页（默认：开启）
  - [x] 保留固定标签页（默认：关闭）
  - [x] 最大保存会话数量（默认：50，范围10-200）
- [x] 数据管理：
  - [x] 导出数据按钮（JSON格式）
  - [x] 导入数据按钮（JSON格式）
  - [x] 清空所有数据按钮（需二次确认）

注：已重构Settings.vue，移除P3云同步功能，仅保留P0核心设置

### 4.2 Settings Store
- [x] 创建 `stores/settingsStore.js`
- [x] State定义：
  - [x] `autoClose: true` - 自动关闭标签页
  - [x] `keepPinned: false` - 保留固定标签页
  - [x] `maxSessions: 50` - 最大会话数
  - [x] `isLoaded: false` - 加载状态
- [x] Actions实现：
  - [x] `loadSettings()` - 加载设置
  - [x] `updateSetting(key, value)` - 更新单个设置
  - [x] `saveSettings()` - 保存所有设置
  - [x] `resetSettings()` - 重置为默认值

---

## 5. Manifest配置

### 5.1 基础Manifest（manifest.json）
- [x] 配置 manifest_version: 3
- [x] 设置扩展名称、版本、描述
- [x] 配置扩展图标（16/48/128）
- [x] 配置 action 点击行为
- [x] 声明必要权限：
  - [x] `tabs` - 标签页操作
  - [x] `tabGroups` - 标签页组访问
  - [x] `storage` - 本地存储
  - [x] `activeTab` - 当前标签页
- [x] 配置 background service worker
- [x] 配置 web_accessible_resources

---

## 6. 构建与打包

### 6.1 Vite构建配置优化
- [x] 确保 `chromeExtensionPlugins()` 正常工作
- [x] 自动复制 manifest.json
- [x] 自动复制 background.js
- [x] 自动生成图标（16/48/128）
- [x] 生成默认favicon

### 6.2 开发调试
- [x] npm run dev 本地开发
- [x] npm run build 生产构建
- [x] 加载dist文件夹到Chrome测试

---

## 📋 P0开发检查清单

### 里程碑检查点

#### Milestone 1: 基础架构（Week 1）✅
- [x] Background Service Worker能够正确捕获和保存标签页数据
- [x] UI框架搭建完成，三个主要页面可以正常切换
- [x] Pinia stores创建完成

#### Milestone 2: 核心功能（Week 2）✅
- [x] 会话收纳完整流程可用（保存→显示→恢复）
- [x] 设置功能可以正常读写配置
- [x] Manifest配置正确，扩展可以在Chrome中加载

#### Milestone 3: 测试与优化（Week 3）🚧
- [ ] 所有核心功能测试通过
- [x] 构建流程稳定
- [x] 基础错误处理完成

---

## 🎯 验收标准

### 功能完整性
- [x] 点击扩展图标能保存当前窗口所有标签页
- [x] 保存的会话能在扩展页面正确显示
- [x] 可以恢复单个标签页、单个组、整个会话
- [x] 基础设置可以正常修改和保存
- [x] 支持会话置顶功能
- [x] 支持固定标签页过滤
- [x] 支持最大会话数限制
- [x] 支持数据导入/导出

### 性能要求
- [ ] 保存50个标签页耗时 < 1秒（待测试）
- [ ] 恢复50个标签页耗时 < 3秒（待测试）
- [ ] UI响应时间 < 100ms（待测试）

### 稳定性要求
- [x] 无明显bug（代码层面已完成）
- [x] 数据不丢失（使用chrome.storage.local持久化）
- [x] Chrome重启后数据持久化

---

## 📊 预计工作量

- **总计**: 约120-150小时
- **Backend Service**: 20-25小时
- **UI Framework**: 15-20小时
- **Sessions Module**: 40-50小时
- **Settings**: 10-15小时
- **Build & Test**: 20-25小时
- **Bug Fix & Polish**: 15-20小时

---

## ⚠️ 风险与依赖

### 技术风险
- Chrome Extension API兼容性问题
- 大量标签页时的性能问题
- Storage容量限制（chrome.storage.local最大5MB）

### 依赖项
- Chrome浏览器版本 >= 88（支持Manifest V3）
- Vue 3 + Vite开发环境
- 必要的npm包已安装

### 缓解措施
- 提前进行API测试
- 实现数据分页和虚拟滚动
- 监控Storage使用量，实现自动清理策略
