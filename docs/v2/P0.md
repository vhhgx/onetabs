# P0 - 核心功能（MVP必须）

> **优先级**：P0 - 最高优先级  
> **目标**：实现产品MVP的基础功能  
> **预计时间**：2-3周  
> **状态图例**：✅ 已完成 | 🚧 进行中 | ⏳ 待开始

---

## 1. Background Service Worker（后台服务）

### 1.1 扩展图标点击处理
- [ ] 监听扩展图标点击事件 `chrome.action.onClicked`
- [ ] 获取当前窗口信息 `chrome.windows.getCurrent()`
- [ ] 触发标签页保存流程

### 1.2 标签页数据获取
- [ ] 使用 `chrome.tabs.query()` 获取当前窗口所有标签页
- [ ] 使用 `chrome.tabGroups.query()` 获取标签页组信息
- [ ] 获取每个标签页的详细信息：
  - [ ] 标题（title）
  - [ ] URL（url）
  - [ ] 图标（favIconUrl）
  - [ ] 是否固定（pinned）
  - [ ] 所属分组ID（groupId）
  - [ ] 索引位置（index）

### 1.3 数据组织与存储
- [ ] 将标签页按分组组织成结构化数据
- [ ] 区分已分组和未分组的标签页
- [ ] 生成唯一会话ID和时间戳
- [ ] 保存数据到 `chrome.storage.local`
- [ ] 存储键名：`onetabs_sessions`

### 1.4 标签页关闭逻辑
- [ ] 获取所有需要关闭的标签页ID
- [ ] 过滤掉扩展自身页面
- [ ] 可选：根据设置过滤固定标签页
- [ ] 批量关闭标签页 `chrome.tabs.remove()`
- [ ] 确保至少保留一个标签页（扩展页面）

### 1.5 扩展页面打开
- [ ] 关闭完成后自动打开扩展页面
- [ ] 使用 `chrome.tabs.create()` 创建新标签页
- [ ] 跳转到扩展主页 `index.html`

---

## 2. 基础UI框架搭建

### 2.1 页面布局结构
- [ ] 创建顶部导航栏组件 `AppHeader.vue`
  - [ ] Logo和产品名称显示
  - [ ] 设置按钮
- [ ] 创建Tab导航组件 `TabNavigation.vue`
  - [ ] 三个Tab：窗口模板、标签页组、会话收纳
  - [ ] Tab切换逻辑
  - [ ] 高亮当前活动Tab

### 2.2 路由配置
- [ ] 配置 Vue Router
- [ ] 三个主要路由：
  - [ ] `/templates` - 窗口模板页
  - [ ] `/collections` - 标签页组页
  - [ ] `/sessions` - 会话收纳页（默认）
- [ ] 设置默认路由为会话收纳

---

## 3. 会话收纳功能（Sessions）

### 3.1 Pinia Store - sessionsStore
- [ ] 创建 `stores/sessionsStore.js`
- [ ] State定义：
  - [ ] `sessions: []` - 所有会话列表
  - [ ] `currentSession: null` - 当前查看的会话
- [ ] Actions实现：
  - [ ] `loadSessions()` - 从Storage加载会话
  - [ ] `saveSession(data)` - 保存新会话
  - [ ] `deleteSession(id)` - 删除会话
  - [ ] `restoreSession(id)` - 恢复整个会话
  - [ ] `restoreGroup(sessionId, groupId)` - 恢复单个组
  - [ ] `restoreTab(sessionId, tabId)` - 恢复单个标签页

### 3.2 会话列表展示
- [ ] 创建 `SessionCard.vue` 组件
  - [ ] 显示保存时间（相对时间格式）
  - [ ] 显示标签页总数
  - [ ] 显示操作按钮：恢复、删除
  - [ ] 支持折叠/展开
- [ ] 创建 `TabGroup.vue` 组件（会话内的标签页组）
  - [ ] 显示组名称和颜色指示器
  - [ ] 显示组内标签页数量
  - [ ] 标签页列表展示
  - [ ] 操作按钮：恢复组、删除组
- [ ] 创建 `TabItem.vue` 组件
  - [ ] 显示网站图标（favicon）
  - [ ] 显示页面标题
  - [ ] 点击打开链接
  - [ ] 悬停显示完整URL

### 3.3 会话数据结构
```javascript
{
  id: string,              // 唯一ID
  timestamp: number,       // 保存时间戳
  windowId: number,        // 窗口ID
  groups: [                // 标签页组列表
    {
      groupId: number,
      title: string,
      color: string,
      collapsed: boolean,
      tabs: [...]
    }
  ],
  ungroupedTabs: []        // 未分组的标签页
}
```

### 3.4 会话恢复功能
- [ ] 恢复整个会话：
  - [ ] 创建新窗口或在当前窗口打开
  - [ ] 按原结构恢复所有标签页
  - [ ] 恢复标签页组（Chrome Tab Groups）
  - [ ] 设置组颜色和名称
- [ ] 恢复单个标签页组：
  - [ ] 批量创建组内所有标签页
  - [ ] 创建Chrome Tab Group
  - [ ] 应用组配置
- [ ] 恢复单个标签页：
  - [ ] 在新标签页打开URL
  - [ ] 保持原有数据不变

### 3.5 会话删除功能
- [ ] 删除确认对话框
- [ ] 从sessions数组中移除
- [ ] 更新Storage
- [ ] 显示删除成功提示

---

## 4. 基础设置功能

### 4.1 设置页面 `Settings.vue`
- [ ] 创建设置页面组件
- [ ] 快速收纳设置：
  - [ ] 点击图标后自动关闭标签页（默认：开启）
  - [ ] 保留固定标签页（默认：关闭）
  - [ ] 最大保存会话数量（默认：50）
- [ ] 数据管理：
  - [ ] 清空会话收纳按钮
  - [ ] 清空所有数据按钮（需二次确认）

### 4.2 Settings Store
- [ ] 创建 `stores/settingsStore.js`
- [ ] State定义：
  - [ ] `autoClose: true` - 自动关闭标签页
  - [ ] `keepPinned: false` - 保留固定标签页
  - [ ] `maxSessions: 50` - 最大会话数
- [ ] Actions实现：
  - [ ] `loadSettings()` - 加载设置
  - [ ] `updateSettings(key, value)` - 更新设置
  - [ ] `resetSettings()` - 重置为默认值

---

## 5. Manifest配置

### 5.1 基础Manifest（manifest.json）
- [ ] 配置 manifest_version: 3
- [ ] 设置扩展名称、版本、描述
- [ ] 配置扩展图标（16/48/128）
- [ ] 配置 action 点击行为
- [ ] 声明必要权限：
  - [ ] `tabs` - 标签页操作
  - [ ] `tabGroups` - 标签页组访问
  - [ ] `storage` - 本地存储
  - [ ] `activeTab` - 当前标签页
- [ ] 配置 background service worker
- [ ] 配置 web_accessible_resources

---

## 6. 构建与打包

### 6.1 Vite构建配置优化
- [ ] 确保 `chromeExtensionPlugins()` 正常工作
- [ ] 自动复制 manifest.json
- [ ] 自动复制 background.js
- [ ] 自动生成图标（16/48/128）
- [ ] 生成默认favicon

### 6.2 开发调试
- [ ] npm run dev 本地开发
- [ ] npm run build 生产构建
- [ ] 加载dist文件夹到Chrome测试

---

## 📋 P0开发检查清单

### 里程碑检查点

#### Milestone 1: 基础架构（Week 1）
- [ ] Background Service Worker能够正确捕获和保存标签页数据
- [ ] UI框架搭建完成，三个主要页面可以正常切换
- [ ] Pinia stores创建完成

#### Milestone 2: 核心功能（Week 2）
- [ ] 会话收纳完整流程可用（保存→显示→恢复）
- [ ] 设置功能可以正常读写配置
- [ ] Manifest配置正确，扩展可以在Chrome中加载

#### Milestone 3: 测试与优化（Week 3）
- [ ] 所有核心功能测试通过
- [ ] 构建流程稳定
- [ ] 基础错误处理完成

---

## 🎯 验收标准

### 功能完整性
- [ ] 点击扩展图标能保存当前窗口所有标签页
- [ ] 保存的会话能在扩展页面正确显示
- [ ] 可以恢复单个标签页、单个组、整个会话
- [ ] 基础设置可以正常修改和保存

### 性能要求
- [ ] 保存50个标签页耗时 < 1秒
- [ ] 恢复50个标签页耗时 < 3秒
- [ ] UI响应时间 < 100ms

### 稳定性要求
- [ ] 无明显bug
- [ ] 数据不丢失
- [ ] Chrome重启后数据持久化

---

## 📊 预计工作量

- **总计**: 约120-150小时
- **Backend Service**: 20-25小时
- **UI Framework**: 15-20小时
- **Sessions Module**: 40-50小时
- **Settings**: 10-15小时
- **Build & Test**: 20-25小时
- **Bug Fix & Polish**: 15-20小时

---

## ⚠️ 风险与依赖

### 技术风险
- Chrome Extension API兼容性问题
- 大量标签页时的性能问题
- Storage容量限制（chrome.storage.local最大5MB）

### 依赖项
- Chrome浏览器版本 >= 88（支持Manifest V3）
- Vue 3 + Vite开发环境
- 必要的npm包已安装

### 缓解措施
- 提前进行API测试
- 实现数据分页和虚拟滚动
- 监控Storage使用量，实现自动清理策略
