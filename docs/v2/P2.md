# P2 - 优化功能

> **优先级**：P2 - 中优先级  
> **目标**：增强用户体验，提升产品竞争力  
> **预计时间**：1-2周（在P1完成后开始）  
> **状态图例**：✅ 已完成 | 🚧 进行中 | ⏳ 待开始

---

## 10. 高级拖拽功能

### 10.1 批量拖拽
- [ ] 支持Ctrl/Cmd多选标签页
- [ ] 支持Shift连续选择
- [ ] 多选状态视觉标识（复选框或背景色）
- [ ] 拖拽时显示"N个标签页"徽章
- [ ] 批量添加到目标
- [ ] 保持标签页顺序

### 10.2 会话标签页组 → 窗口模板
- [ ] 在SessionCard的TabGroup组件添加draggable
- [ ] 拖拽整个标签页组（包含所有标签页）
- [ ] 保留组名称、颜色
- [ ] 添加到模板的collections数组（快照模式）
- [ ] 自动设置createGroup=true

### 10.3 标签页组管理 → 窗口模板（引用模式）
- [ ] 在CollectionCard添加draggable
- [ ] 拖拽到TemplateCard的DropZone
- [ ] 建立引用关系：
  - [ ] 保存collectionId
  - [ ] 设置isReference=true
  - [ ] 显示引用图标
- [ ] 引用模式自动同步：
  - [ ] 标签页组更新时，模板自动获取最新数据
  - [ ] 在模板编辑界面显示"最新版本"提示
- [ ] 支持切换为快照模式（"锁定版本"按钮）

### 10.4 跨区域拖拽
- [ ] 标签页组A → 标签页组B（标签页移动/复制）
- [ ] 标签页组内标签页 → 窗口模板（提取为独立标签）
- [ ] 窗口模板内的标签页组 → 标签页组管理（可选）

### 10.5 拖拽操作撤销
- [ ] 记录最近一次拖拽操作
- [ ] 提供"撤销"按钮（Toast中）
- [ ] 恢复到拖拽前的状态
- [ ] 3秒后自动消失

### 10.6 拖拽中断处理
- [ ] 按ESC键取消拖拽
- [ ] 拖出窗口外自动取消
- [ ] 拖拽中断时恢复原状态
- [ ] 无错误提示（静默处理）

---

## 11. 搜索功能

### 11.1 全局搜索框
- [ ] 创建 `SearchBar.vue` 组件
- [ ] 放置在AppHeader顶部导航栏
- [ ] 输入框样式和占位符
- [ ] 实时搜索（防抖300ms）

### 11.2 搜索逻辑实现
- [ ] 搜索范围：
  - [ ] 会话中的标签页（标题、URL）
  - [ ] 标签页组（组名、标签页标题、URL）
  - [ ] 窗口模板（模板名、描述）
- [ ] 搜索算法：
  - [ ] 模糊匹配
  - [ ] 支持中文拼音搜索（可选）
  - [ ] 关键词高亮显示
- [ ] 搜索结果展示：
  - [ ] 按类型分组显示
  - [ ] 点击结果跳转到对应位置
  - [ ] 显示匹配度排序

### 11.3 搜索过滤器（可选）
- [ ] 按类型过滤（会话/标签页组/模板）
- [ ] 按时间范围过滤
- [ ] 按标签页组颜色过滤

---

## 12. 数据导入导出

### 12.1 导出功能
- [ ] 在Settings页面添加"导出数据"按钮
- [ ] 导出格式：JSON
- [ ] 导出内容：
  - [ ] 所有会话
  - [ ] 所有标签页组
  - [ ] 所有窗口模板
  - [ ] 用户设置
- [ ] 生成文件名：`onetabs-backup-YYYYMMDD.json`
- [ ] 使用浏览器下载API

### 12.2 导入功能
- [ ] 在Settings页面添加"导入数据"按钮
- [ ] 文件选择器（accept=".json"）
- [ ] 数据验证：
  - [ ] 检查JSON格式
  - [ ] 验证数据结构
  - [ ] 处理版本兼容性
- [ ] 导入策略选择：
  - [ ] 覆盖现有数据
  - [ ] 合并数据（保留现有+导入新的）
- [ ] 显示导入结果统计

### 12.3 数据迁移（可选）
- [ ] 支持从OneTab导入
- [ ] 支持从其他标签管理器导入
- [ ] 数据格式转换

---

## 13. 右键菜单增强

### 13.1 上下文菜单组件
- [ ] 创建 `ContextMenu.vue` 组件
- [ ] 支持右键触发
- [ ] 菜单项配置化
- [ ] 位置自动计算（避免超出视口）

### 13.2 会话标签页右键菜单
- [ ] 打开
- [ ] 复制URL
- [ ] 添加到标签页组
- [ ] 添加到窗口模板
- [ ] 删除

### 13.3 标签页组右键菜单
- [ ] 打开（新窗口/当前窗口）
- [ ] 编辑
- [ ] 复制
- [ ] 添加到窗口模板
- [ ] 删除

### 13.4 窗口模板右键菜单
- [ ] 打开
- [ ] 编辑
- [ ] 复制
- [ ] 导出为JSON
- [ ] 删除

---

## 14. 快捷键支持

### 14.1 快捷键配置
- [ ] 在manifest.json中配置commands
- [ ] 常用快捷键：
  - [ ] `Ctrl/Cmd+Shift+S` - 快速保存当前窗口
  - [ ] `Ctrl/Cmd+Shift+O` - 打开扩展页面
  - [ ] `Ctrl/Cmd+F` - 聚焦搜索框
  - [ ] `ESC` - 关闭弹窗/取消操作

### 14.2 快捷键提示
- [ ] 在相关按钮上显示快捷键提示
- [ ] 添加快捷键帮助页面（可选）

---

## 15. 性能优化

### 15.1 虚拟滚动
- [ ] 当会话/标签页组数量 > 50 时启用
- [ ] 使用 vue-virtual-scroller 或自实现
- [ ] 只渲染可见区域的DOM
- [ ] 减少内存占用

### 15.2 图标缓存
- [ ] 缓存favicon到本地
- [ ] 使用IndexedDB或chrome.storage
- [ ] 避免重复请求
- [ ] 默认图标fallback

### 15.3 懒加载
- [ ] 会话内容默认折叠，点击展开时才渲染
- [ ] 标签页组同理
- [ ] 减少首屏渲染时间

### 15.4 防抖和节流
- [ ] 搜索输入防抖（300ms）
- [ ] 拖拽事件节流
- [ ] 窗口大小变化节流

---

## 16. UI/UX优化

### 16.1 动画效果
- [ ] 列表项添加/删除的过渡动画
- [ ] 展开/折叠的过渡动画
- [ ] 拖拽的视觉反馈动画
- [ ] Toast提示的淡入淡出

### 16.2 响应式设计
- [ ] 适配不同窗口宽度
- [ ] 侧边栏可折叠（可选）
- [ ] 卡片式布局自适应

### 16.3 无障碍支持
- [ ] 键盘导航（Tab键）
- [ ] ARIA标签
- [ ] 高对比度模式支持

### 16.4 空状态设计
- [ ] 无会话时的友好提示
- [ ] 无标签页组时的引导
- [ ] 首次使用的新手引导

---

## 17. 错误处理与日志

### 17.1 错误处理
- [ ] 全局错误捕获
- [ ] Chrome API调用失败处理
- [ ] Storage读写失败处理
- [ ] 网络错误处理（favicon加载失败）

### 17.2 错误提示
- [ ] 友好的错误提示信息
- [ ] 提供解决建议
- [ ] 避免技术术语

### 17.3 日志系统（可选）
- [ ] 记录关键操作日志
- [ ] 记录错误日志
- [ ] 在设置页面查看日志
- [ ] 支持导出日志用于调试

---

## 📋 P2开发检查清单

### 里程碑检查点

#### Milestone 1: 高级交互（Week 1 前半）
- [ ] 高级拖拽功能全部实现
- [ ] 批量拖拽、跨区域拖拽、撤销功能
- [ ] 全局搜索功能完成
- [ ] 右键菜单实现

#### Milestone 2: 数据管理与体验优化（Week 1 后半）
- [ ] 数据导入导出功能
- [ ] 快捷键支持
- [ ] 基础动画和过渡效果
- [ ] 空状态设计完成

#### Milestone 3: 性能与稳定性（Week 2）
- [ ] 虚拟滚动实现
- [ ] 图标缓存机制
- [ ] 懒加载优化
- [ ] 错误处理完善
- [ ] 性能测试通过

---

## 🎯 验收标准

### 高级拖拽
- [ ] 可以多选并批量拖拽标签页
- [ ] 可以拖拽整个标签页组到窗口模板
- [ ] 标签页组拖拽到模板时可选引用/快照模式
- [ ] 拖拽后可以撤销操作（3秒内）

### 搜索功能
- [ ] 搜索响应速度 < 300ms
- [ ] 可以搜索所有类型的内容
- [ ] 搜索结果正确高亮
- [ ] 点击结果可以跳转到对应位置

### 数据管理
- [ ] 可以导出所有数据为JSON文件
- [ ] 可以导入JSON文件并选择合并/覆盖策略
- [ ] 导入导出过程有进度提示

### 性能优化
- [ ] 100+会话场景下，首屏渲染 < 2秒
- [ ] 滚动流畅，无明显卡顿
- [ ] 内存占用合理（< 100MB）

### 用户体验
- [ ] 所有主要操作有动画反馈
- [ ] 支持键盘快捷键
- [ ] 右键菜单方便快捷
- [ ] 空状态有友好提示

---

## 📊 预计工作量

- **总计**: 约80-100小时
- **高级拖拽**: 20-25小时
- **搜索功能**: 15-20小时
- **数据导入导出**: 10-15小时
- **右键菜单**: 8-10小时
- **快捷键**: 5-8小时
- **性能优化**: 15-20小时
- **UI/UX优化**: 12-15小时
- **错误处理**: 8-10小时

---

## ⚠️ 风险与依赖

### 技术风险
- 虚拟滚动实现复杂，可能影响现有组件结构
- 搜索性能可能受数据量影响
- IndexedDB使用可能有兼容性问题

### 依赖项
- P0和P1功能必须稳定运行
- 拖拽基础架构已完成
- 所有核心组件已实现

### 缓解措施
- 使用成熟的虚拟滚动库（vue-virtual-scroller）
- 实现搜索索引和缓存机制
- 提供chrome.storage作为IndexedDB的fallback
- 分阶段实现，每个功能独立测试

---

## 💡 优化建议

### 开发优先级建议
1. 先完成高级拖拽和搜索（最能提升用户体验）
2. 然后实现数据导入导出（数据安全保障）
3. 再做性能优化（解决大数据量场景问题）
4. 最后完善UI/UX细节（锦上添花）

### 可选功能
以下功能可以根据时间和资源情况选择性实现：
- 中文拼音搜索
- 搜索过滤器
- 从其他工具导入数据
- 快捷键帮助页面
- 日志系统
- 侧边栏折叠

---

## 🧪 测试重点

### 拖拽测试
- [ ] 批量选择和拖拽（多种选择方式）
- [ ] 跨区域拖拽所有场景
- [ ] 引用模式和快照模式切换
- [ ] 撤销功能在各种场景下的表现
- [ ] 拖拽中断处理

### 性能测试
- [ ] 100个会话场景测试
- [ ] 1000个标签页场景测试
- [ ] 内存泄漏检测
- [ ] 长时间运行稳定性测试

### 兼容性测试
- [ ] 不同Chrome版本测试
- [ ] Windows/Mac/Linux平台测试
- [ ] 不同分辨率和DPI测试
