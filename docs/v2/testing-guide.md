# P0 功能测试指南

## 测试前准备

### 1. 构建扩展
```bash
pnpm install
pnpm run build
```

### 2. 加载扩展到 Chrome
1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目的 `dist` 目录

---

## 功能测试清单

### ✅ 1. 基础架构测试

#### 1.1 Tab 切换
- [ ] 点击扩展图标，打开插件页面
- [ ] 查看是否显示三个 Tab：Sessions / Collections / Templates
- [ ] 点击每个 Tab，确认可以正常切换
- [ ] 切换 Tab 后再切换回来，确认状态被保留（KeepAlive 生效）

#### 1.2 导航
- [ ] 顶部导航栏显示 "OneTabs" 品牌
- [ ] 页面布局正常，无样式错误

---

### ✅ 2. 会话收纳功能测试

#### 2.1 收纳普通标签页
1. 打开多个普通标签页（如：Google、GitHub、MDN）
2. 点击扩展图标
3. **预期结果：**
   - [ ] 所有标签页被收纳到一个会话中
   - [ ] 会话显示在 Sessions 列表中
   - [ ] 会话标题为"未分组标签"
   - [ ] 会话时间显示为"刚刚"
   - [ ] 会话显示正确的标签页数量

#### 2.2 收纳分组标签页
1. 创建一个标签页分组（如："工作"组，包含 3 个标签页）
2. 点击扩展图标
3. **预期结果：**
   - [ ] 分组标签页被收纳为一个独立会话
   - [ ] 会话标题为分组名称"工作"
   - [ ] 会话显示组颜色指示器
   - [ ] 会话包含正确数量的标签页

#### 2.3 收纳固定标签页（开启保留设置）
1. 固定 2 个标签页
2. 打开 3 个普通标签页
3. 进入 Settings，开启"保留固定标签页"
4. 点击扩展图标收纳标签页
5. **预期结果：**
   - [ ] 只有普通标签页被收纳
   - [ ] 固定标签页仍然保留打开状态
   - [ ] Toast 提示收纳成功

---

### ✅ 3. 会话管理测试

#### 3.1 查看会话列表
- [ ] Sessions 页面显示所有已收纳的会话
- [ ] 会话按时间倒序排列（最新的在最上面）
- [ ] 每个会话卡片显示：标题、时间、标签页数量
- [ ] 置顶的会话显示在列表顶部，带蓝色边框和背景

#### 3.2 展开/折叠会话
1. 点击会话卡片右侧的展开按钮（▶）
2. **预期结果：**
   - [ ] 会话展开，显示标签页列表
   - [ ] 展开按钮变为 ▼
   - [ ] 有平滑的展开动画
3. 再次点击按钮
4. **预期结果：**
   - [ ] 会话折叠，隐藏标签页列表
   - [ ] 有平滑的折叠动画

#### 3.3 查看标签页详情
展开会话后：
- [ ] 每个标签页显示网站图标（favicon）
- [ ] 显示标签页标题
- [ ] 显示标签页 URL
- [ ] 鼠标悬停时有高亮效果

#### 3.4 恢复整个会话
1. 点击会话卡片的"恢复"按钮（↻）
2. **预期结果：**
   - [ ] 所有标签页被打开在新窗口/当前窗口
   - [ ] Toast 提示"会话已恢复"
   - [ ] 如果是分组会话，标签页被恢复到对应的分组中

#### 3.5 恢复单个标签页
1. 展开会话
2. 点击其中一个标签页
3. **预期结果：**
   - [ ] 该标签页在新标签页中打开
   - [ ] 其他标签页不受影响

#### 3.6 置顶会话
1. 点击会话的置顶按钮（📌）
2. **预期结果：**
   - [ ] 会话移动到列表顶部
   - [ ] 会话卡片显示蓝色边框和背景
   - [ ] 左上角显示置顶图标
   - [ ] Toast 提示"会话已置顶"
3. 再次点击置顶按钮
4. **预期结果：**
   - [ ] 会话取消置顶
   - [ ] 会话回到按时间排序的位置
   - [ ] Toast 提示"已取消置顶"

#### 3.7 删除会话
1. 点击会话的删除按钮（🗑️）
2. **预期结果：**
   - [ ] 弹出确认对话框
   - [ ] 对话框显示："确定要删除此会话吗？此操作无法撤销。"
3. 点击"删除"
4. **预期结果：**
   - [ ] 会话从列表中消失
   - [ ] Toast 提示"会话已删除"
5. 点击"取消"
6. **预期结果：**
   - [ ] 会话保留，不被删除

---

### ✅ 4. 设置功能测试

#### 4.1 进入设置页面
1. 在 Sessions 页面，点击右上角的 Settings Tab（如果有）
   或者通过其他方式进入设置页面
2. **预期结果：**
   - [ ] 显示"基础设置"部分
   - [ ] 显示"数据管理"部分

#### 4.2 自动关闭设置
1. 勾选"收纳标签页后自动关闭插件页面"
2. **预期结果：**
   - [ ] Toast 提示"设置已保存"
   - [ ] 设置被保存到 chrome.storage
3. 打开一些标签页，点击扩展图标收纳
4. **预期结果：**
   - [ ] 收纳后，插件页面自动关闭（功能待后续实现）

#### 4.3 保留固定标签页设置
1. 勾选"保留固定标签页"
2. **预期结果：**
   - [ ] Toast 提示"设置已保存"
3. 固定一些标签页，然后收纳标签页
4. **预期结果：**
   - [ ] 固定标签页不被关闭
   - [ ] 固定标签页不被收纳到会话中

#### 4.4 最大保存会话数设置
1. 修改"最大保存会话数量"为 20
2. **预期结果：**
   - [ ] Toast 提示"设置已保存"
3. 创建超过 20 个会话
4. **预期结果：**
   - [ ] 最多只保留 20 个非置顶会话
   - [ ] 最旧的会话被自动删除
   - [ ] 置顶会话不受此限制

#### 4.5 输入验证
1. 尝试输入小于 10 的数字
2. **预期结果：**
   - [ ] 自动修正为 10
3. 尝试输入大于 200 的数字
4. **预期结果：**
   - [ ] 自动修正为 200

---

### ✅ 5. 数据管理测试

#### 5.1 导出数据
1. 创建几个会话
2. 点击"导出数据"按钮
3. **预期结果：**
   - [ ] 自动下载 JSON 文件
   - [ ] 文件名格式：`onetabs_backup_YYYY-MM-DD.json`
   - [ ] Toast 提示"导出成功"
4. 打开下载的 JSON 文件
5. **预期结果：**
   - [ ] 包含 `sessions` 数组
   - [ ] 包含 `settings` 对象
   - [ ] 包含 `exportDate` 和 `version`

#### 5.2 导入数据
1. 点击"导入数据"按钮
2. 选择之前导出的 JSON 文件
3. **预期结果：**
   - [ ] Toast 提示"导入成功"
   - [ ] 显示导入的会话数量
   - [ ] 会话出现在 Sessions 列表中
   - [ ] 设置被应用

#### 5.3 导入无效数据
1. 创建一个无效的 JSON 文件
2. 尝试导入
3. **预期结果：**
   - [ ] Toast 提示"导入失败"
   - [ ] 显示错误信息
   - [ ] 原有数据不受影响

#### 5.4 清除所有数据
1. 点击"清除所有数据"按钮
2. **预期结果：**
   - [ ] 弹出确认对话框
   - [ ] 对话框显示："确定要删除所有已保存的会话数据吗？此操作无法撤销。"
3. 点击"确定清除"
4. **预期结果：**
   - [ ] 所有会话被删除
   - [ ] Sessions 列表显示空状态
   - [ ] Toast 提示"清除成功"
5. 点击"取消"
6. **预期结果：**
   - [ ] 数据保留，不被清除

---

### ✅ 6. Toast 通知测试

验证以下操作都有对应的 Toast 提示：
- [ ] 设置保存成功
- [ ] 设置保存失败
- [ ] 会话置顶/取消置顶
- [ ] 会话恢复成功
- [ ] 会话恢复失败
- [ ] 会话删除成功
- [ ] 数据导出成功
- [ ] 数据导出失败
- [ ] 数据导入成功
- [ ] 数据导入失败
- [ ] 数据清除成功
- [ ] 数据清除失败

---

### ✅ 7. 确认对话框测试

验证以下操作都有确认对话框：
- [ ] 删除会话
- [ ] 清除所有数据

确认对话框要求：
- [ ] 显示清晰的警告信息
- [ ] 有"取消"和"确定"按钮
- [ ] 按钮文字明确（如"删除"、"确定清除"）
- [ ] 有警告图标

---

### ✅ 8. 边界情况测试

#### 8.1 空状态
1. 清除所有会话
2. **预期结果：**
   - [ ] Sessions 页面显示空状态消息
   - [ ] 提示用户如何开始使用

#### 8.2 大量会话
1. 创建 50+ 个会话
2. **预期结果：**
   - [ ] 页面加载流畅
   - [ ] 滚动性能正常
   - [ ] 不会崩溃或卡顿

#### 8.3 长标题和 URL
1. 创建包含超长标题和 URL 的标签页
2. 收纳标签页
3. **预期结果：**
   - [ ] 文本被正确截断
   - [ ] 布局不被破坏
   - [ ] 可以通过 tooltip 查看完整内容

#### 8.4 特殊字符
1. 创建包含特殊字符的标签页标题
2. 收纳并恢复
3. **预期结果：**
   - [ ] 特殊字符正确保存和显示
   - [ ] 不会出现编码问题

---

### ✅ 9. 性能测试

#### 9.1 加载性能
- [ ] 首次打开插件页面 < 1秒
- [ ] 切换 Tab < 200ms
- [ ] 展开会话 < 300ms

#### 9.2 操作响应
- [ ] 点击按钮后立即有反馈（loading 状态或动画）
- [ ] Toast 提示在操作完成后立即显示
- [ ] 没有明显的卡顿或延迟

#### 9.3 内存占用
- [ ] 打开开发者工具查看内存使用
- [ ] 确保没有明显的内存泄漏
- [ ] 多次操作后内存占用稳定

---

### ✅ 10. 兼容性测试

#### 10.1 Chrome 版本
测试 Chrome 版本：
- [ ] Chrome 100+
- [ ] Chrome 最新稳定版

#### 10.2 屏幕分辨率
- [ ] 1920x1080 (Full HD)
- [ ] 1366x768 (常见笔记本分辨率)
- [ ] 2560x1440 (2K)

#### 10.3 缩放级别
- [ ] 100% 缩放
- [ ] 125% 缩放
- [ ] 150% 缩放

---

## 常见问题排查

### 问题：点击扩展图标没有反应
- 检查 manifest.json 中的 permissions
- 检查 background.js 是否正确加载
- 查看扩展的后台页面控制台是否有错误

### 问题：会话没有被保存
- 打开 Chrome DevTools -> Application -> Storage -> Local Storage
- 查看是否有 `tabGroups` 数据
- 检查 background.js 的 console 日志

### 问题：Toast 或 ConfirmDialog 不显示
- 检查 main.js 是否注册了服务
- 检查 App.vue 是否添加了组件
- 查看浏览器控制台是否有错误

### 问题：设置没有生效
- 检查 chrome.storage 中是否有 `onetabs_settings` 数据
- 查看 settingsStore 的 console 日志
- 确认 background.js 读取了设置

---

## 测试完成标准

所有测试项都通过 ✅，没有重大 bug，即可认为 P0 功能测试完成。

---

## 下一步

测试完成后：
1. 记录发现的 bug 并修复
2. 收集用户反馈
3. 规划 P1 功能开发
